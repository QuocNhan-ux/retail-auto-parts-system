{% extends "base.html" %}

{% block title %}Home - Autoparts System{% endblock %}

{% block content %}
<div class="hero">
    <h1>Find the Right Parts for Your Vehicle</h1>
    <p>Shop thousands of quality auto parts at great prices. Fast shipping and easy returns.</p>
    <div class="search-box">
        <input type="text" placeholder="Search by part name or number...">
        <button>Search</button>
    </div>
</div>

<div class="categories">
    <h2>Shop by Category</h2>
    <div class="category-grid">
        <div class="category-card">
            <h3>Engine Parts</h3>
            <p>Pistons, gaskets, filters & more</p>
        </div>
        <div class="category-card">
            <h3>Brakes</h3>
            <p>Pads, rotors, calipers & lines</p>
        </div>
        <div class="category-card">
            <h3>Suspension</h3>
            <p>Shocks, struts & control arms</p>
        </div>
        <div class="category-card">
            <h3>Electrical</h3>
            <p>Batteries, alternators & starters</p>
        </div>
        <div class="category-card">
            <h3>Exhaust</h3>
            <p>Mufflers, pipes & catalytic converters</p>
        </div>
        <div class="category-card">
            <h3>Body Parts</h3>
            <p>Bumpers, fenders & mirrors</p>
        </div>
    </div>
</div>

<div class="featured-products">
    <h2>Featured Products</h2>
    <div class="product-grid">
        <div class="product-card">
            <div class="product-image">[Image]</div>
            <h3>Brake Pad Set</h3>
            <p class="price">$49.99</p>
            <button class="add-to-cart" data-part-id="PART_ID" data-quantity="1">
                Add to Cart
            </button>
        </div>
        <div class="product-card">
            <div class="product-image">[Image]</div>
            <h3>Oil Filter</h3>
            <p class="price">$12.99</p>
            <button class="add-to-cart" data-part-id="PART_ID" data-quantity="1">
                Add to Cart
            </button>
        </div>
        <div class="product-card">
            <div class="product-image">[Image]</div>
            <h3>Air Filter</h3>
            <p class="price">$18.99</p>
            <button class="add-to-cart" data-part-id="PART_ID" data-quantity="1">
                Add to Cart
            </button>
        </div>
        <div class="product-card">
            <div class="product-image">[Image]</div>
            <h3>Spark Plugs (Set of 4)</h3>
            <p class="price">$24.99</p>
            <button class="add-to-cart" data-part-id="PART_ID" data-quantity="1">
                Add to Cart
            </button>
        </div>
        <div class="product-card">
            <div class="product-image">[Image]</div>
            <h3>Battery</h3>
            <p class="price">$259.99</p>
            <button class="add-to-cart" data-part-id="PART_ID" data-quantity="1">
                Add to Cart
            </button>
        </div>
        <div class="product-card">
            <div class="product-image">[Image]</div>
            <h3>Wiper Blade</h3>
            <p class="price">$26.99</p>
            <button class="add-to-cart" data-part-id="PART_ID" data-quantity="1">
                Add to Cart
            </button>
        </div>
    </div>
</div>
<script>
    (function () {
        const csrftoken = (document.cookie.match(/csrftoken=([^;]+)/) || [null, ''])[1];
        const cartLink = document.getElementById('nav-cart');
    
        function updateCartNav(count) {
            if (cartLink && typeof count === 'number') {
                cartLink.textContent = `Cart (${count})`;
            }
        }
    
        document.querySelectorAll('.add-to-cart').forEach(btn => {
            btn.addEventListener('click', async () => {
                const partId = btn.getAttribute('data-part-id');
                const quantity = parseInt(btn.getAttribute('data-quantity') || '1', 10);
    
                try {
                    const res = await fetch('/api/cart/add/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken,
                        },
                        body: JSON.stringify({ part_id: partId, quantity: quantity }),
                    });
    
                    const data = await res.json();
                    if (res.ok && data.success) {
                        alert('Added to cart!');
                        updateCartNav(data.cart_count);
                    } else if (res.status === 401) {
                        alert('Please sign in before adding items to your cart.');
                        window.location.href = "{% url 'customer-login-page' %}";
                    } else {
                        alert(data.error || 'Could not add to cart.');
                    }
                } catch (err) {
                    console.error(err);
                    alert('Unexpected error adding to cart.');
                }
            });
        });
    })();
    </script>
{% endblock %}
